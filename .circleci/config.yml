version: 2.1
description: Expo setup for React Native

orbs:
  expo: ryanpedersen/expo@0.1.0

executors:
  node:
    docker:
      - image: cimg/node:14.0.0

jobs:
  expo_build_and_get_ipa:
    executor: node
    steps:
      - checkout
      - restore_cache:
          keys:
            - node-cache-v1-{{ .Branch }}-{{ checksum "package-lock.json" }}
            - node-cache-v1-{{ .Branch }}-
            - node-cache-v1-
      - run:
          name: Fetch dependencies
          command: npm install
      - save_cache:
          paths:
            - ~/.npm
            - ~/.cache
          key: node-cache-v1-{{ .Branch }}-{{ checksum "package-lock.json" }}
      - expo/expo-auth
      - expo/expo-build
      - expo/get-ios-ipa
  expo_get_ipa:
    executor: node
    steps:
      - checkout
      - restore_cache:
          keys:
            - node-cache-v1-{{ .Branch }}-{{ checksum "package-lock.json" }}
            - node-cache-v1-{{ .Branch }}-
            - node-cache-v1-
      - run:
          name: Fetch dependencies
          command: npm install
      - save_cache:
          paths:
            - ~/.npm
            - ~/.cache
          key: node-cache-v1-{{ .Branch }}-{{ checksum "package-lock.json" }}
      - expo/expo-auth
      - expo/get-ios-ipa

workflows:
  build_expo:
    jobs:
      # - expo_build_and_get_ipa
      - expo_get_ipa